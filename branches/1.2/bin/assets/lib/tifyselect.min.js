!function(t,e,i){var s=t.valHooks.div;t.valHooks.div={get:function(e){return void 0===t(e).tiFySelect("instance")?s&&s.get&&s.get(e)||void 0:t(e).data("value")},set:function(e,i){if(void 0===t(e).tiFySelect("instance"))return s&&s.set&&s.set(e,i)||void 0;t(e).data("value",i)}},t.widget("tify.tiFySelect",{options:{disabled:!1,multiple:!1,duplicate:!1,max:-1,trigger:{},picker:{},sortable:{},source:!1,autocomplete:!1},controllers:{handler:"tiFy-selectHandler",trigger:"tiFy-selectTrigger",autocompleteInput:"tiFy-selectAutocomplete",selectedList:"tiFy-selectSelectedItems",picker:"tiFy-selectPicker",pickerList:"tiFy-selectPickerItems",pickerFilter:"tiFy-selectPickerFilter",pickerLoader:"tiFy-selectPickerLoader"},_create:function(){this.instance=this,this.el=this.element,this._initOptions(),this._initControllers(),this._initStatusFlags(),this._initEvents()},_initOptions:function(){this.el.data("options")&&t.extend(this.options,t.parseJSON(decodeURIComponent(this.el.data("options")))),this.options.source?("object"!=typeof this.options.source&&(this.options.source={}),this.dataSource=this.options.source):this.dataSource=void 0},_initStatusFlags:function(){this.flags={isDisabled:!0,isMultiple:!1,isDuplicable:!1,isRemovable:!0,isSortable:!1,isOpen:!1,isComplete:!0,page:1,hasArrow:!0,hasFilter:!1,hasSource:!1,hasAutocomplete:!1},this.flags.Disabled=this.options.disabled,this.flags.isMultiple=this.options.multiple,this.flags.isDuplicable=this.options.duplicate&&this.flags.isMultiple,this.flags.isRemovable=!this.flags.Disabled,this.flags.isSortable=!1!==this.options.sortable&&this.flags.isMultiple&&!this.flags.Disabled,this.flags.isOpen=!1,this.flags.isComplete=!1,this.flags.page=1,this.flags.hasSource=void 0!==this.dataSource},_initControllers:function(){var e=this;t.each(this.controllers,function(i,s){e[i]=t("."+s,e.el)})},_initEvents:function(){this._initTrigger(),this._initPicker(),this._initSelected(),this.flags.isMultiple?this.el.attr("aria-multiple",!0):this.el.attr("aria-multiple",!1),this.flags.isSortable?this.el.attr("aria-sortable",!0):this.el.attr("aria-sortable",!1),this.flags.isDuplicable?(this.el.attr("aria-duplicable",!0),this.picker.attr("aria-duplicable",!0)):(this.el.attr("aria-duplicable",!1),this.picker.attr("aria-duplicable",!1)),this.flags.Disabled?this._disable():this._enable()},_initTrigger:function(){this.options.trigger=t.extend({arrow:!0},this.options.trigger),this.options.trigger.arrow?(this.flags.hasArrow=!0,this.trigger.attr("aria-arrow",!0)):(this.flags.hasArrow=!1,this.trigger.attr("aria-arrow",!1)),this.options.autocomplete&&("object"!=typeof this.options.autocomplete&&(this.options.autocomplete={}),this.flags.hasAutocomplete=!0,this.el.attr("aria-autocomplete",!0),this.flags.isMultiple&&this.selectedList.insertAfter(this.trigger),this.autocompleteInput=t('<input class="tiFy-selectAutocomplete" autocomplete="off"/>').prependTo(this.trigger))},_initPicker:function(){this.options.picker=t.extend({placement:"clever",appendTo:"body",delta:{top:0,left:0,width:0},adminbar:!0,filter:!1},this.options.picker);var e=t(this.options.picker.appendTo);e.length||(e=t("body")),this.picker.appendTo(e),this.options.picker.filter&&(this.flags.hasFilter=!0,this.picker.attr("aria-filter",!0),this.pickerFilter=t('<input class="tiFy-selectPickerFilter" autocomplete="off"/>').prependTo(this.picker))},_initSelected:function(){var e=this;e.flags.isSortable?(e.options.sortable=t.extend({handle:'[aria-handle="sort"]',containment:"parent",update:function(){e._reset()}},e.options.sortable),e.sortable=e.selectedList.sortable(e.options.sortable),e.selectedList.disableSelection()):e.sortable=void 0,e._reset()},_open:function(){if(!this.flags.isOpen){this.flags.isOpen=!0,this.el.attr("aria-open",!0),this.picker.attr("aria-open",!0);var t=this._getPickerOffset();this.picker.css(t),this._getPickerItems(),this._onOpen()}},_close:function(){this.flags.isOpen&&(this.flags.isOpen=!1,this.el.attr("aria-open",!1),this.picker.attr("aria-open",!1),this._onClose())},_enable:function(){this.flags.Disabled=!1,this.el.attr("aria-disabled",!1),this.handler.prop("disabled",!1),this._onEnable()},_disable:function(){this.flags.Disabled=!0,this.el.attr("aria-disabled",!0),this.handler.prop("disabled",!0),this._onDisable()},_add:function(e){!this.flags.isDuplicable&&t('> [data-value="'+e.value+'"]',this.selectedList).length?e.new=!1:(e.new=!0,this.flags.isMultiple||this._removeAll(),e.index=this._count(),t('<li data-label="'+e.label+'" data-value="'+e.value+'" data-index="'+e.index+'">'+(void 0!==e.select?e.select:e.label)+"</li>").appendTo(this.selectedList)),this._onAdd(e)},_remove:function(e){this._get(e.index).remove(),t('> [data-index="'+e.index+'"]',this.handler).remove(),t('> [data-value="'+e.value+'"]',this.selectedList).length||t('> [data-value="'+e.value+'"]',this.pickerList).attr("aria-selected",!1),this._onRemove(e)},_get:function(e){return t('> li[data-index="'+e+'"]',this.selectedList)},_removeAll:function(){var e=this;e._all().each(function(){var i=e._getAttrs(t(this));e._get(i.index).remove(),t('> [data-index="'+i.index+'"]',e.handler).remove(),t('> [data-value="'+i.value+'"]',e.selectedList).length||t('> [data-value="'+i.value+'"]',e.pickerList).attr("aria-selected",!1)}),e.el.val(e.handler.val())},_reset:function(){var e=this;t("option",e.handler).remove(),e._all().each(function(){var i=e._getAttrs(t(this));e._setRemovable(i),e._setSortable(i),e._addHandler(i),e._setPicker(i)}),e.el.val(e.handler.val())},_all:function(){return t("> li",this.selectedList)},_count:function(){return this._all().length},_highlight:function(e){t('> [data-value="'+e.value+'"]',this.selectedList).attr("aria-highlight",!0).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){t(this).attr("aria-highlight",!1)})},_setRemovable:function(t){this.flags.isRemovable&&this._get(t.index).prepend('<span aria-handle="remove">Ã—</span>')},_setSortable:function(t){this.flags.isSortable&&(this.options.sortable.handle?this._get(t.index).prepend('<span aria-handle="sort">...</span>'):this._get(t.index).attr("aria-handle","sort"))},_onOpen:function(){var s=this;t(e).on("click.tify_select.outside"+s.instance.uuid,function(e){var i=!0;t.each(s.controllers,function(a,l){if(t(e.target).is(t("."+l,s.el)))return i=!1,!0}),i&&s._close()}),t(i).on("scroll.tify_select.picker_position."+s.instance.uuid,function(){var t=s._getPickerOffset();s.picker.css(t)}),s.pickerList.on("scroll.tify_select.picker_list."+s.instance.uuid,function(){t(this).prop("scrollHeight")-t(this).innerHeight()-t(this).scrollTop()<20&&s._getPickerItems()}),s.flags.hasFilter&&s.pickerFilter.on("keyup.tify_select.picker_filter."+s.instance.uuid,function(){var e=t(this).val();t("> li",s.pickerList).each(function(){var i=new RegExp(e,"i");t(this).data("label").match(i)?t(this).show():t(this).hide()})}),s.flags.hasFilter&&s.pickerFilter.focus()},_onClose:function(){t(e).off("click.tify_select.outside"+this.instance.uuid),t(i).off("scroll.tify_select.picker_position."+this.instance.uuid),this.pickerList.off("scroll.tify_select.picker_list."+this.instance.uuid),this.flags.hasFilter&&this.pickerFilter.off("keyup.tify_select.picker_filter."+this.instance.uuid)},_onEnable:function(){var e=this;e.trigger.on("click.tify_select.open."+e.instance.uuid,function(){e.flags.isOpen?e._close():e._open()}),t('> li:not([aria-disabled="true"])',e.pickerList).on("click.tify_select.picker_item_select."+e.instance.uuid,function(){var i=e._getAttrs(t(this));e._add(i)}),e.flags.isRemovable&&t('> li > [aria-handle="remove"]',e.selectedList).on("click.tify_select.selected_remove."+e.instance.uuid,function(){var i=e._getAttrs(t(this).closest("li"));e._remove(i)}),this._count()||this.selectedList.hide(),e.flags.hasAutocomplete&&e.autocompleteInput.on("keyup.tify_select.autocomplete."+e.instance.uuid,function(){e._close(),t(this).val()&&(e.pickerList.empty(),e.flags.isComplete=!1,e.flags.page=1,void 0!==e.timeout&&clearTimeout(e.timeout),void 0!==e.xhr&&e.xhr.abort(),e.timeout=setTimeout(function(){e._getPickerItems(),e.xhr.done(function(t){t.length&&e._open()})},1e3))})},_onDisable:function(){this.trigger.off("click.tify_select.open."+this.instance.uuid),t("> li",this.pickerList).on("click.tify_select.picker_item_select."+this.instance.uuid),this.flags.isRemovable&&t('> li > [aria-handle="remove"]',this.selectedList).off("click.tify_select.selected_remove."+this.instance.uuid),this.flags.hasAutocomplete&&this.autocompleteInput.off("keyup.tify_select.autocomplete."+this.instance.uuid)},_onAdd:function(e){var i=this;e.new&&(i._setRemovable(e),i.flags.isRemovable&&t('> [aria-handle="remove"]',i._get(e.index)).on("click.tify_select.selected_remove."+i.instance.uuid,function(){i._remove(e)}),i._setSortable(e),i._setPicker(e),i._addHandler(e)),i.selectedList.show(),i._close(),i._highlight(e),i.el.val(i.handler.val()),i.el.trigger("tify_select.add")},_onRemove:function(t){this._count()||this.selectedList.hide(),this.el.val(this.handler.val()),this.el.trigger("tify_select.remove")},_getAttrs:function(t){return{label:t.data("label"),value:t.data("value"),index:t.data("index"),picker:t.data("picker")?t.data("picker"):t.data("label"),select:t.data("select")?t.data("select"):t.data("label")}},_addPicker:function(e){var i=this;t('> [data-value="'+e.value+'"]',i.pickerList).length||(t('<li data-label="'+e.label+'" data-value="'+e.value+'" data-index="'+e.value+'" >'+(void 0!==e.picker?e.picker:e.label)+"</li>").appendTo(i.pickerList).on("click.tify_select.picker_item_select."+i.instance.uuid,function(){i._add(e)}),i._setPicker(e))},_setPicker:function(e){t('> [data-value="'+e.value+'"]',this.selectedList).length?t('> [data-value="'+e.value+'"]',this.pickerList).attr("aria-selected",!0):t('> [data-value="'+e.value+'"]',this.pickerList).attr("aria-selected",!1)},_queryPickerArgs:function(){var t={page:this.flags.page};return this.flags.hasAutocomplete&&(t.term=this.autocompleteInput.val()),t},_getPickerItems:function(){var e=this;e.flags.isComplete||this.flags.hasSource&&(e.pickerLoader.show(),e.xhr=t.ajax({url:tify_ajaxurl,data:t.extend(e.dataSource,e._queryPickerArgs()),method:"POST"}).done(function(i){i.length?(t.each(i,function(t,i){e._addPicker(i)}),e.flags.page++):(e.flags.isComplete=!0,e.flags.page=1)}).always(function(){e.pickerLoader.hide()}))},_getPickerOffset:function(){var e=t.extend({},this.trigger.offset(),{width:this.trigger.outerWidth()}),s=this.options.picker.placement;switch(this.options.picker.delta.top&&(e.top+=this.options.picker.delta.top),this.options.picker.delta.left&&(e.left+=this.options.picker.delta.left),this.options.picker.delta.width&&(e.width+=this.options.picker.delta.width),this.options.picker.adminbar&&(e.top+=t("body").hasClass("admin-bar")?-t("#wpadminbar").outerHeight():0),"clever"===s&&(s=t(i).outerHeight()+t(i).scrollTop()<e.top+this.picker.outerHeight()?"top":"bottom"),s){case"top":e.top-=this.picker.outerHeight()-1;break;case"bottom":e.top+=this.trigger.outerHeight()-1}return e},_addHandler:function(e){t('[data-index="'+e.index+'"]',this.handler).length||t('<option value="'+e.value+'" data-index="'+e.index+'" selected>'+e.label+"</option>").appendTo(this.handler)},sortable:function(){if(this.flags.isSortable)return this.sortable},open:function(){this.flags.Disabled||this._open()},close:function(){this.flags.Disabled||this._close()},enable:function(){this.flags.Disabled&&this._enable()},disable:function(){this.flags.Disabled||this._disable()},destroy:function(){this.el.remove(),this.picker.remove()}})}(jQuery,document,window);